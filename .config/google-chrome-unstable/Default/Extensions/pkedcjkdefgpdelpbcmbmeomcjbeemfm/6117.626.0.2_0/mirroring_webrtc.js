'use strict';var y4={TAB:0,fg:1,Xi:2},z4=function(a){cb("MediaRouter.WebRtc.Start.Success",a,y4)};var D4=function(a,b){mf.call(this,b);this.s=a;this.a=new eb;this.h=yr(b.id);this.f=new eb;this.w=!1;this.j=null;this.u=!1;this.m=this.b=null;A4(this);B4(this);C4(this,new sf("GET_TURN_CREDENTIALS"))};la(D4,mf);D4.prototype.start=function(a){var b=this;return this.a.a.then(function(c){if(c.b)return Promise.reject(new Ae("Mirroring already started"));if(b.j)return Promise.reject(new Ae("Session permanently stopped"));b.b=new Sa("MediaRouter.WebRtc.Session.Launch");c.a.addStream(a);c.start();return b.f.a})};
D4.prototype.stop=function(){var a=this;this.f.reject(new Ae("Session stop requested."));this.m&&(this.m.a(),this.m=null);if(this.j)return this.j;this.u=this.w=!1;this.b=null;return this.j=this.a.a.then(function(a){a.stop()}).then(function(){return a.h.sa()}).catch(function(b){a.h.sa();throw b;})};
var A4=function(a){a.h.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.a.resolve(new xf(a.g.id,b.data.credentials));break;case "ANSWER":a.a.a.then(function(a){Ff(a,b.data)});break;case "KNOCK_ANSWER":a.u=!0;a.a.a.then(function(a){Ff(a,b.data)});break;case "STOP":a.f.reject(new Ae("Stop signal received"));a.stop();break;default:throw new Ae("Unknown message type: "+b.type);}}},B4=function(a){a.a.a.then(function(b){Bf(b,function(b){C4(a,
new sf("OFFER",new uf(b,a.s,vf)))});Cf(b,function(b){C4(a,tf(b))});yf(b,function(){a.w=!0;C4(a,new sf("SESSION_START_SUCCESS"));!a.u&&a.b&&a.b.a();a.b=null;a.m=new Za("MediaRouter.WebRtc.Session.Length");a.f.resolve(a)});Af(b,function(){C4(a,new sf("SESSION_END"))});zf(b,function(b){a.w||a.f.reject(b);C4(a,new sf("SESSION_FAILURE"))})})},C4=function(a,b){a.h.sendMessage(b,E4)},E4={channelType:"cloud"};var F4=function(){bf.call(this,"webrtc")};la(F4,bf);h=F4.prototype;h.le=function(a,b){return new D4(a,b)};h.Je=function(){z4(0)};h.Ge=function(){z4(1)};h.Jf=function(){z4(2)};h.He=function(){bb("MediaRouter.WebRtc.Session.End")};h.Ie=function(a){cb("MediaRouter.WebRtc.Start.Failure",a,ze)};h.Od=function(){bb("MediaRouter.WebRtc.Stream.End")};var G4=new F4;$e("mr.mirror.webrtc.WebRtcService",G4);
